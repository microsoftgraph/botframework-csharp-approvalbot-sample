---
page_type: sample
products:
- office-outlook
- office-onedrive
- ms-graph
languages:
- csharp
description: "Образец ленты, использующий использование адаптивных карт и пакета SDK .NET Graph для отправки транзактных сообщений, запрашивающих утверждение, для освобождения файлов в OneDrive."
extensions:
  contentType: samples
  technologies:
  - Microsoft Graph
  - Microsoft Bot Framework
  services:
  - Outlook
  - OneDrive
  createdDate: 4/23/2018 12:12:07 PM
---
# Образец Bot по утверждению

## Локальное выполнение

Выполните следующие действия, чтобы разрешить локальный запуск бота для отладки.

### Предварительные требования

- [ngrok](https://ngrok.com/)
- [Эмулятор Bot Framework](https://github.com/Microsoft/BotFramework-Emulator/releases)
- [Эмулятор Azure Cosmos DB](https://docs.microsoft.com/en-us/azure/cosmos-db/local-emulator)
- Visual Studio 2017

### Регистрация приложения

1. Откройте браузер и перейдите в [Центр администрирования Azure Active Directory](https://aad.portal.azure.com). Войдите с помощью **рабочей или учебной учетной записи**.

1. Выберите **Azure Active Directory** на панели навигации слева, затем выберите **Регистрация приложения (предварительный просмотр)** в разделе **Управление**.

    ![Снимок экрана раздела регистрации приложений](readme-images/aad-portal-app-registrations.png)

1. Выберите **Новая регистрация**. На странице **Регистрация приложения** задайте необходимые значения следующим образом:

    - Установите предпочтительное **Имя**, например, `Бот Утверждения`.
    - Задайте для параметра **Поддерживаемые типы учетных записей** значение **Учетные записи в любом каталоге организации**.
    - В разделе **перенаправления URI** выберите в первом раскрывающемся списке значение `веб` и задайте для него значение `http://localhost:3979/callback`.

    ![Снимок экрана: страница "Регистрация приложения"](readme-images/aad-register-an-app.PNG)

1. Нажмите кнопку **Зарегистрировать**. На странице **Утверждение бота** скопируйте значение **идентификатора приложения (клиента)** и сохраните его, оно понадобится вам на следующем шаге.

    ![Снимок экрана: идентификатор приложения для новой регистрации](readme-images/aad-application-id.PNG)

1. Выберите **Сертификаты и секреты** в разделе **Управление**. Нажмите кнопку **Новый секрет клиента**. Введите значение в поле **Описание**, выберите один из вариантов для **Срок действия** и нажмите **Добавить**.

    ![Снимок экрана: диалоговое окно "Добавление секрета клиента"](readme-images/aad-new-client-secret.png)

1. Скопируйте значение секрета клиента, а затем покиньте эту страницу. Оно вам понадобится на следующем шаге.

    > [ВАЖНО!]
    > Этот секрет клиента больше не будет отображаться, поэтому обязательно скопируйте его.

    ![Снимок экрана: только что добавленный секрет клиента](readme-images/aad-copy-client-secret.png)

### Настройте прокси-сервер ngrok

Вы должны предоставить общедоступную конечную точку HTTPS для получения уведомлений от эмулятора Bot Framework. Во время тестирования вы можете использовать ngrok, чтобы временно разрешить сообщения из эмулятора Bot Framework для туннелирования на порт *localhost* на вашем компьютере.

Можно использовать веб-интерфейс ngrok ([http://127.0.0.1:4040](http://127.0.0.1:4040)), чтобы проверить трафик HTTP, проходящий по туннелю. Дополнительные сведения об использовании ngrok см. в статье [веб-сайт ngrok](https://ngrok.com/).


1. [Скачайте ngrok](https://ngrok.com/download) для Windows.

1. Распакуйте пакет и запустите ngrok. exe.

1. Запустите следующую командную строку в консоли ngrok:

    ```Shell
    ngrok http 3979 --host-header=localhost:3979
    ```

    ![Пример команды для выполнения в консоли ngrok](readme-images/ngrok1.PNG)

1. Скопируйте URL-адрес HTTPS, который отображается на консоли. Вы будете использовать это для настройки вашего `NgrokRootUrl`в примере.

    ![URL-адрес переадресации HTTPS на консоли ngrok](readme-images/ngrok2.PNG)

    > **Примечание.** Не закрывайте консоль во время тестирования. Если вы ее закроете, то также закроется туннель и вам потребуется создать новый URL-адрес и обновить пример.

### Настройка и запуск примера

1. Создайте копию репозитория локально.
1. Сделайте копию файла **./ApprovalBot/PrivateSettings.example.config** в том же каталоге и назовите копию `PrivateSettings.config`.
1. Откройте **ApprovalBot.sln** в Visual Studio, затем откройте файл **PrivateSettings.config**.

1. Задайте в качестве значения `MicrosoftAppId`идентификатор приложения (клиента), сгенерированный на предыдущем шаге, а в качестве значения `MicrosoftAppPassword`укажите секрет, созданный впоследствии.

1. Вставьте значение URL-адреса ngrok HTTPS, скопированное из предыдущего шага, в значение `NgrokRootUrl` в **PrivateSettings.config**и сохраните изменения.

    > **Внимание!** При запуске примера оставьте ngrok запущенным. Если вы перейдете на ngrok, а затем перезапустите его, URL-адрес пересылки изменится, и вам потребуется обновить значение `NgrokRootUrl`.

1. Запустите эмулятор Azure Cosmos DB. Это должно быть запущено до запуска образца.

1. Нажмите F5, чтобы отладить образец.

1. Запустите Bot Framework Emulator. Вверху, где написано: **Введите URL-адрес вашей конечной точки**, введите `https://localhost:3979/api/messages`.

1. Это запросит идентификатор приложения и пароль. Введите идентификатор приложения и секрет и оставьте **Locale** пустым.

    ![](readme-images/configure-emulator.PNG)

1. Щелкните **Подключить**.

1. Чтобы убедиться в подключении `Привет`.

    ![](readme-images/hello-bot.PNG)

## Ограничения при запуске локально

При запуске примера на локальном компьютере отправляются сообщения с запросом на утверждение. Поскольку он не работает на подтвержденном, зарегистрированном домене, мы должны отправить сообщение в одну и ту же учетную запись. Это означает, что когда вы достигаете точки, в которой вы запрашиваете одобрение, вы должны включить себя в список утверждающих.

Вы можете включить других утверждающих, но сообщение, которое они получают, не будет отображать адаптивную карту. Войдите в свой почтовый ящик с Outlook, чтобы проверить адаптивную карту.

## Участие

Мы всегда рады предложениям и помощи в работе над проектом.
Обычно для добавления своих вариантов необходимо принять Лицензионное соглашение с участником (CLA), заявив,
что вы имеете право предоставлять и предоставляете нам права на использование своего варианта. Подробности см. на сайте https://cla.microsoft.com.

Когда вы будете отправлять запрос на вытягивание, CLA-бот автоматически определит, нужно ли вам предоставить CLA и соответствующим образом изменит внешний вид запроса на вытягивание (например, добавит метку, комментарий).
Просто следуйте инструкциям бота.
Это нужно будет сделать всего один раз для добавления своих вариантов во все репозитории, использующие наш CLA.

Этот проект соответствует [Правилам поведения разработчиков открытого кода Майкрософт](https://opensource.microsoft.com/codeofconduct/).
Дополнительные сведения см. в разделе [Часто задаваемые вопросы о правилах поведения](https://opensource.microsoft.com/codeofconduct/faq/).
Если у вас возникли вопросы или замечания, напишите нам по адресу [opencode@microsoft.com](mailto:opencode@microsoft.com).

## Авторские права

(c) Корпорация Майкрософт (Microsoft Corporation), 2019. Все права защищены.
